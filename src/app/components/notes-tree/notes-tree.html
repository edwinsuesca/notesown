<div class="notes-tree-container">
  <div class="flex items-center justify-between mb-3 px-2">
    <h2 class="text-lg font-semibold m-0">Notas</h2>
    <p-button
      icon="pi pi-folder-plus"
      [text]="true"
      [rounded]="true"
      size="large"
      (onClick)="createNewFolder()"
      pTooltip="Nueva carpeta"
      tooltipPosition="bottom">
    </p-button>
  </div>

  <!-- Árbol personalizado -->
  <div class="custom-tree">
    @if (loading) {
      <div class="text-center py-4">
        <i class="pi pi-spin pi-spinner text-2xl"></i>
      </div>
    }

    @if (!loading && treeNodes.length === 0) {
      <div class="text-center py-4 text-surface-500 dark:text-surface-400">
        <i class="pi pi-folder-open text-3xl mb-2"></i>
        <p class="text-sm">No hay carpetas aún</p>
      </div>
    }

    @if (!loading && treeNodes.length > 0) {
      <div class="tree-nodes">
        @for (folderNode of treeNodes; track folderNode.key) {
          <div class="tree-node-item">
            <!-- Nodo carpeta -->
             @let folderLength = folderNode.children?.length || 0;
             @let folderCount = folderLength > 0 ? folderLength - 1 : 0;
            <div 
              class="tree-node-content folder-node"
              [class.selected]="isNodeSelected(folderNode)"
              (click)="onNodeClick(folderNode, $event)">
              <i [class]="getNodeIcon(folderNode)"></i>
              <span class="tree-node-label">{{ folderNode.label }} ({{folderCount}})</span>
            </div>

            <!-- Hijos de la carpeta (notas) -->
            @if (folderNode.expanded && folderNode.children) {
              <div class="tree-node-children">
                @for (childNode of folderNode.children; track childNode.key) {
                  <div 
                    class="tree-node-content child-node"
                    [class.selected]="isNodeSelected(childNode)"
                    [class.new-note-node]="childNode.data.type === 'new-note-button'"
                    (click)="onNodeClick(childNode, $event)">
                    <i [class]="childNode.icon"></i>
                    <span class="tree-node-label">{{ childNode.label }}</span>
                  </div>
                }
              </div>
            }
          </div>
        }
      </div>
    }
  </div>
</div>